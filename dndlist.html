<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Лист персонажа D&D</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 10px;
        background: #f5f5f5;
    }
    h2 { margin-top: 20px; }
    .section { background: #fff; padding: 10px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 5px; }
    input[type=text], input[type=number], textarea, select { width: 100%; padding: 5px; margin-top: 3px; box-sizing: border-box; }
    .flex { display: flex; flex-wrap: wrap; gap: 10px; }
    .flex > div { flex: 1 1 120px; }
    button { padding: 8px 12px; margin-top: 10px; }
    .skills label { display: flex; justify-content: space-between; align-items: center; }
    .dice-result { margin-top: 5px; font-weight: bold; }
    @media(max-width:600px){
        .flex { flex-direction: column; }
    }
</style>
</head>
<body>

<h1>Лист персонажа D&D</h1>

<div class="section">
    <h2>Основное</h2>
    <label>Имя: <input type="text" id="name"></label>
    <label>Класс: <input type="text" id="class"></label>
    <label>Подкласс: <input type="text" id="subclass"></label>
    <div class="flex">
        <div><label>Здоровье: <input type="number" id="hp" min="0"></label></div>
        <div><label>Мана: <input type="number" id="mana" min="0"></label></div>
        <div><label>Класс брони: <input type="number" id="ac" min="0"></label></div>
        <div><label>Инициатива: <input type="number" id="initiative"></label></div>
        <div><label>Скорость: <input type="number" id="speed"></label></div>
        <div><label>Пассивная внимательность: <input type="number" id="passive_perception"></label></div>
        <div><label>Деньги: <input type="text" id="money"></label></div>
    </div>
</div>

<div class="section">
    <h2>Характеристики</h2>
    <div class="flex">
        <div><label>Сила: <input type="number" id="strength"></label></div>
        <div><label>Ловкость: <input type="number" id="dexterity"></label></div>
        <div><label>Выносливость: <input type="number" id="constitution"></label></div>
        <div><label>Интеллект: <input type="number" id="intelligence"></label></div>
        <div><label>Мудрость: <input type="number" id="wisdom"></label></div>
        <div><label>Харизма: <input type="number" id="charisma"></label></div>
    </div>
</div>

<div class="section">
    <h2>Навыки</h2>
    <div class="skills">
        <label>Атлетика <input type="checkbox" id="athletics"></label>
        <label>Акробатика <input type="checkbox" id="acrobatics"></label>
        <label>Ловкость рук <input type="checkbox" id="sleight_of_hand"></label>
        <label>Скрытность <input type="checkbox" id="stealth"></label>
        <label>Анализ <input type="checkbox" id="investigation"></label>
        <label>История <input type="checkbox" id="history"></label>
        <label>Магия <input type="checkbox" id="arcana"></label>
        <label>Природа <input type="checkbox" id="nature"></label>
        <label>Религия <input type="checkbox" id="religion"></label>
        <label>Внимательность <input type="checkbox" id="perception"></label>
        <label>Выживание <input type="checkbox" id="survival"></label>
        <label>Медицина <input type="checkbox" id="medicine"></label>
        <label>Проницательность <input type="checkbox" id="insight"></label>
        <label>Выступление <input type="checkbox" id="performance"></label>
        <label>Запугивание <input type="checkbox" id="intimidation"></label>
        <label>Обман <input type="checkbox" id="deception"></label>
        <label>Убеждение <input type="checkbox" id="persuasion"></label>
    </div>
</div>

<div class="section">
    <h2>Черты, идеалы, привязанности, слабости</h2>
    <label>Черты характера: <textarea id="traits"></textarea></label>
    <label>Идеалы: <textarea id="ideals"></textarea></label>
    <label>Привязанности: <textarea id="bonds"></textarea></label>
    <label>Слабости: <textarea id="flaws"></textarea></label>
</div>

<div class="section">
    <h2>Заклинания</h2>
    <label>Количество ячеек: <input type="number" id="spell_slots" min="0"></label>
    <label>Использовано: <input type="number" id="used_spell_slots" min="0"></label>
</div>

<div class="section">
    <h2>Инвентарь</h2>
    <label>Предметы: <textarea id="items"></textarea></label>
</div>

<div class="section">
    <h2>Броски кубиков</h2>
    <div class="flex">
        <div>
            <label>d4: <input type="number" id="dice_d4" min="1" value="1"></label>
            <button onclick="rollDice('d4')">Бросить</button>
            <div class="dice-result" id="result_d4"></div>
        </div>
        <div>
            <label>d6: <input type="number" id="dice_d6" min="1" value="1"></label>
            <button onclick="rollDice('d6')">Бросить</button>
            <div class="dice-result" id="result_d6"></div>
        </div>
        <div>
            <label>d8: <input type="number" id="dice_d8" min="1" value="1"></label>
            <button onclick="rollDice('d8')">Бросить</button>
            <div class="dice-result" id="result_d8"></div>
        </div>
        <div>
            <label>d12: <input type="number" id="dice_d12" min="1" value="1"></label>
            <button onclick="rollDice('d12')">Бросить</button>
            <div class="dice-result" id="result_d12"></div>
        </div>
        <div>
            <label>d20: <input type="number" id="dice_d20" min="1" value="1"></label>
            <button onclick="rollDice('d20')">Бросить</button>
            <div class="dice-result" id="result_d20"></div>
        </div>
    </div>
</div>

<div class="section">
    <button onclick="saveCharacter()">Сохранить JSON</button>
    <button onclick="loadCharacter()">Загрузить JSON</button>
    <input type="file" id="jsonFile" style="display:none" onchange="handleFile(event)">
</div>

<script>
function rollDice(dice) {
    const num = parseInt(document.getElementById('dice_' + dice).value) || 1;
    let sides = parseInt(dice.replace('d',''));
    let total = 0;
    for (let i = 0; i < num; i++) total += Math.floor(Math.random()*sides)+1;
    document.getElementById('result_' + dice).textContent = total;
}

function getCharacterData() {
    return {
        name: document.getElementById('name').value,
        class: document.getElementById('class').value,
        subclass: document.getElementById('subclass').value,
        hp: document.getElementById('hp').value,
        mana: document.getElementById('mana').value,
        ac: document.getElementById('ac').value,
        initiative: document.getElementById('initiative').value,
        speed: document.getElementById('speed').value,
        passive_perception: document.getElementById('passive_perception').value,
        money: document.getElementById('money').value,
        stats: {
            strength: document.getElementById('strength').value,
            dexterity: document.getElementById('dexterity').value,
            constitution: document.getElementById('constitution').value,
            intelligence: document.getElementById('intelligence').value,
            wisdom: document.getElementById('wisdom').value,
            charisma: document.getElementById('charisma').value
        },
        skills: {
            athletics: document.getElementById('athletics').checked,
            acrobatics: document.getElementById('acrobatics').checked,
            sleight_of_hand: document.getElementById('sleight_of_hand').checked,
            stealth: document.getElementById('stealth').checked,
            investigation: document.getElementById('investigation').checked,
            history: document.getElementById('history').checked,
            arcana: document.getElementById('arcana').checked,
            nature: document.getElementById('nature').checked,
            religion: document.getElementById('religion').checked,
            perception: document.getElementById('perception').checked,
            survival: document.getElementById('survival').checked,
            medicine: document.getElementById('medicine').checked,
            insight: document.getElementById('insight').checked,
            performance: document.getElementById('performance').checked,
            intimidation: document.getElementById('intimidation').checked,
            deception: document.getElementById('deception').checked,
            persuasion: document.getElementById('persuasion').checked
        },
        traits: document.getElementById('traits').value,
        ideals: document.getElementById('ideals').value,
        bonds: document.getElementById('bonds').value,
        flaws: document.getElementById('flaws').value,
        spell_slots: document.getElementById('spell_slots').value,
        used_spell_slots: document.getElementById('used_spell_slots').value,
        items: document.getElementById('items').value
    };
}

function saveCharacter() {
    const data = JSON.stringify(getCharacterData(), null, 2);
    const blob = new Blob([data], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'character.json';
    a.click();
    URL.revokeObjectURL(url);
}

function loadCharacter() {
    document.getElementById('jsonFile').click();
}

function handleFile(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        const data = JSON.parse(e.target.result);
        populateCharacter(data);
    }
    reader.readAsText(file);
}

function populateCharacter(data) {
    document.getElementById('name').value = data.name || '';
    document.getElementById('class').value = data.class || '';
    document.getElementById('subclass').value = data.subclass || '';
    document.getElementById('hp').value = data.hp || '';
    document.getElementById('mana').value = data.mana || '';
    document.getElementById('ac').value = data.ac || '';
    document.getElementById('initiative').value = data.initiative || '';
    document.getElementById('speed').value = data.speed || '';
    document.getElementById('passive_perception').value = data.passive_perception || '';
    document.getElementById('money').value = data.money || '';
    
    if(data.stats){
        document.getElementById('strength').value = data.stats.strength || '';
        document.getElementById('dexterity').value = data.stats.dexterity || '';
        document.getElementById('constitution').value = data.stats.constitution || '';
        document.getElementById('intelligence').value = data.stats.intelligence || '';
        document.getElementById('wisdom').value = data.stats.wisdom || '';
        document.getElementById('charisma').value = data.stats.charisma || '';
    }

    if(data.skills){
        for(let skill in data.skills){
            if(document.getElementById(skill)) document.getElementById(skill).checked = data.skills[skill];
        }
    }

    document.getElementById('traits').value = data.traits || '';
    document.getElementById('ideals').value = data.ideals || '';
    document.getElementById('bonds').value = data.bonds || '';
    document.getElementById('flaws').value = data.flaws || '';
    document.getElementById('spell_slots').value = data.spell_slots || '';
    document.getElementById('used_spell_slots').value = data.used_spell_slots || '';
    document.getElementById('items').value = data.items || '';
}
</script>

</body>
</html>
